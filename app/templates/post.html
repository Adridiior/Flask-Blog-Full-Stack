{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
  <article class="my-4">
    <h1>{{ post.title }}</h1>
    <p>{{ post.content }}</p>
    <p><small>By {{ post.author.username }} on {{ post.date_posted }}</small></p>
    {% if post.author == current_user %}
      <a href="{{ url_for('main.update_post', post_id=post.id) }}" class="btn btn-secondary">Edit</a>
      <form action="{{ url_for('main.delete_post', post_id=post.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this post?');">
        <button type="submit" class="btn btn-danger">Delete</button>
      </form>
    {% endif %}
  </article>

  <h2>Comments</h2>
  {% for comment in post.comments %}
      <div class="card my-2">
        <div class="card-body">
          <p>{{ comment.content }}</p>
          <p class="text-muted">- by {{ comment.author.username }} on {{ comment.date_posted.strftime('%Y-%m-%d %H:%M:%S') }}</p>
          {% if comment.author == current_user %}
            <form action="{{ url_for('main.delete_comment', comment_id=comment.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this comment?');">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          {% endif %}
        </div>
      </div>
  {% endfor %}

  {% if current_user.is_authenticated %}
      <form action="{{ url_for('main.comment_post', post_id=post.id) }}" method="POST" class="my-4">
          {{ form.hidden_tag() }}
          <div class="form-group">
              {{ form.content.label }}
              {{ form.content(class="form-control") }}
          </div>
          <div class="form-group">
              {{ form.submit(class="btn btn-primary") }}
          </div>
      </form>
  {% else %}
      <p>Please <a href="{{ url_for('main.login') }}">login</a> to comment.</p>
  {% endif %}
{% endblock %}
